---
// Navbar adaptativo según el usuario autenticado
interface Props {
  appName?: string;
}

const { appName = 'Paroikiapp' } = Astro.props;
---

<nav id="navbar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
  <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 1rem;">
    <a href="/" style="color: white; text-decoration: none; font-size: 1.5rem; font-weight: bold;">
      ⛪ {appName}
    </a>
    
    <div id="navLinks" style="display: flex; gap: 1.5rem; align-items: center;">
      <!-- Se llena dinámicamente con JavaScript -->
    </div>
  </div>
</nav>

<script>
  // @ts-nocheck
  function updateNavbar() {
    const navLinks = document.getElementById('navLinks');
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    const accessToken = localStorage.getItem('accessToken');
    
    const currentTheme = localStorage.getItem('theme') || 'light';
    const themeText = currentTheme === 'dark' ? 'Modo Claro' : 'Modo Oscuro';

    if (!accessToken || !user) {
      // Usuario no autenticado
      navLinks.innerHTML = `
        <a href="/" style="color: white; text-decoration: none; font-weight: 500;">Inicio</a>
        <a href="/eventos" style="color: white; text-decoration: none; font-weight: 500;">Eventos</a>
        <a href="/contacto" style="color: white; text-decoration: none; font-weight: 500;">Contacto</a>
        <button onclick="toggleTheme()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">${themeText}</button>
        <a href="/login" style="background: white; color: #667eea; padding: 0.5rem 1.5rem; border-radius: 0.5rem; text-decoration: none; font-weight: 600;">Iniciar Sesión</a>
      `;
    } else {
      // Usuario autenticado
      const isAdmin = user.rol === 'organizador' || user.rol === 'administrador';
      const isMonitor = user.rol === 'monitor';
      
      let links = `<a href="/" style="color: white; text-decoration: none; font-weight: 500;">Inicio</a>`;
      links += `<a href="/eventos" style="color: white; text-decoration: none; font-weight: 500;">Eventos</a>`;
      links += `<a href="/contacto" style="color: white; text-decoration: none; font-weight: 500;">Contacto</a>`;
      
      if (isAdmin) {
        links += `<a href="/admin" style="color: white; text-decoration: none; font-weight: 500;">Panel Admin</a>`;
        links += `<a href="/monitor" style="color: white; text-decoration: none; font-weight: 500;">Monitor (Gestión)</a>`;
      }

      if (isMonitor || isAdmin) {
        links += `<a href="/panel-monitor" style="color: white; text-decoration: none; font-weight: 500;">Panel de Monitor</a>`;
        links += `<a href="/usuarios" style="color: white; text-decoration: none; font-weight: 500;">Usuarios</a>`;
      }

      if (isAdmin) {
        links += `<a href="/configuracion" style="color: white; text-decoration: none; font-weight: 500;">Configuración</a>`;
      }
      
      links += `
        <button onclick="toggleTheme()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
          ${themeText}
        </button>
        <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">${user.nombre_mostrado}</span>
        <button onclick="logout()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
          Cerrar Sesión
        </button>
      `;
      
      navLinks.innerHTML = links;
    }
  }
  
  function logout() {
    localStorage.removeItem('accessToken');
    localStorage.removeItem('refreshToken');
    localStorage.removeItem('user');
    window.location.href = '/';
  }

  function toggleTheme() {
    const current = localStorage.getItem('theme') || 'light';
    const next = current === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', next);
    document.documentElement.setAttribute('data-theme', next);
    updateNavbar();
  }
  
  window.logout = logout;
  window.toggleTheme = toggleTheme;
  
  // Actualizar navbar al cargar
  updateNavbar();
  
  // Actualizar cuando cambie el storage (en otras pestañas)
  window.addEventListener('storage', updateNavbar);
</script>

<style>
  nav a:hover {
    opacity: 0.8;
    transition: opacity 0.2s;
  }
  
  nav button:hover {
    background: rgba(255,255,255,0.3) !important;
    transition: background 0.2s;
  }
</style>
